<template name="OperatorDashboardLayout">

  <div class="row">

    <div class=" col s12 m2 no-right-pad">
      <div class="operator-customers card-border z-depth-0 card ">
        <!-- FORCE SPAN TO BE RESTRICTED BY WEB-BROWSER AUTOSIZE -->
        <span class="black-text">{{> usersTab }}
        </span>
      </div>
    </div>

    <!-- MAKE THIS MORE EFFICIENT BY HAVING A WITH STATEMENT FOR USERPROFILES AND THEN PASS IT DOWN...BECAUSE THERE ARE SOME MANY CALLS FROM THIS PAGE FOR IT -->
    {{#with SecureDashboardLink}}
      <div class=" col s12 m5 no-right-pad">
        <div class="operator-info card-border z-depth-0 card ">
          <span class="black-text">{{> userInfoCard customerId=this}}
          </span>
        </div>
        <div class="operator-chat card-border z-depth-0 card ">
          <span class="black-text">{{> userChatCard customerId=this}}
          </span>
        </div>
      </div>
      <div class="col s12 m5">
        <div class="operator-api card-border z-depth-0 card ">
          <span class="black-text">{{> apiCard customerId=this}}
          </span>
        </div>
        <div class="operator-status card-border z-depth-0 card">
          <span class="black-text ">
            <div class="col s12 status-size">
              {{> statusCard customerId=this}}
            </div>
          </span>
        </div>
      </div>
      {{else}}
      <div class=" col s12 m5 no-right-pad">
        <div class="operator-info card-border z-depth-0 card ">
          <span class="black-text">
            {{> userInfoCard}}
          </span>
        </div>
        <div class="operator-chat card-border z-depth-0 card ">
          <span class="black-text">
            {{> userChatCard}}
          </span>
        </div>
      </div>
      <div class="col s12 m5">
        <div class="operator-api card-border z-depth-0 card ">
          <span class="black-text">{{> apiCard}}
          </span>
        </div>
        <div class="operator-status card-border z-depth-0 card">
          <span class="black-text ">
            <div class="col s12 status-size">
              {{> statusCard disable="disabled"}}
            </div>
          </span>
        </div>
      </div>
  {{/with}}

  </div>
</template>

<template name="usersTab">

   <div class="row no-bottom-margin">
    <div class="col s12 operator-dash-title valign-wrapper">
      <div class="auto-width center-align ellipsis">CUSTOMERS</div>
    </div>
    <div class="col s12 divider "></div>
  </div>

  <div class="scrollable-serving ">
    {{> userStatus}}
  </div>

<div class="col s12 divider"></div>

  <div class="find-user-box ellipsis">
    {{> getUser}}
  </div>
</template>

<template name="userStatus">
  <div class="customer-names">
    <table class="highlight">
      <tbody>
       {{#each customer in customers}}
          <tr class="highlight-size" id={{servingColor customer.userId}} >

            <a href={{customerPageLink customer.userId}}>

              <div class="names-padding ellipsis">

                <span class=" new badge green right" data-badge-caption=" "> 4 </span>
               {{customer.firstName}}
               {{customer.lastName}}

             </div>

            </a>
          </tr>
       {{/each}}
      </tbody>
    </table>
  </div>
</template>

<template name="getUser">
  {{#if searching}}
    <a class="notSeeking">
       <div class="preloader-wrapper big active loader-margins">
        <div class="spinner-layer spinner-blue-only">
          <div class="circle-clipper left">
            <div class="circle"></div>
          </div><div class="gap-patch">
            <div class="circle"></div>
          </div><div class="circle-clipper right">
            <div class="circle"></div>
          </div>
        </div>
      </div>
    </a>

    Searching...

  {{else}}

    {{#if customersWaiting}}
      <a class=" getUser pulse btn-floating btn-large waves-effect waves-light orange"><i class=" material-icons">add</i></a>
    {{else}}

      <a class=" getUser btn-floating btn-large waves-effect waves-light orange"><i class=" material-icons">add</i></a>
    {{/if}}

  Find Customer

  {{/if}}
</template>

<template name="userInfoCard">
  <div class="row">
    <div class="col s12">
      <ul class="tabs">
        <li class="tab col s6"><a href="#info">Information</a></li>
        <li class="tab col s6"><a href="#hist">History</a></li>
      </ul>
    </div>
    <div id="info" class="col s12">
      <ul class="tabs">
        <li class="tab col s4"><a class="active" href="#account">Account</a></li>
        <li class="tab col s4"><a href="#favorites">Favorites</a></li>
        <li class="tab col s4"><a href="#addresses">Addresses</a></li>
      </ul>
      <div class="scrollable-info">
        <div id="account" class="col s12">
          {{#with userInfo customerId}}
          <div class="row">
            <form class="col s12">
              <div class="row">
                <div class="input-field col s6">
                  <input disabled value="{{this.firstName}}" id="first_name" type="text" class="validate">
                  <label class="active" for="first_name">First Name</label>
                </div>
                <div class="input-field col s6">
                  <input disabled value="{{this.lastName}}" id="last_name" type="text" class="validate">
                  <label class="active" for="last_name">Last Name</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s6">
                  <input disabled value="{{this.phone}}" id="phone" type="text" class="validate">
                  <label class="active" for="phone">Phone</label>
                </div>
                <div class="input-field col s6">
                  <input disabled value="{{this.balance}}" id="balance" type="text" class="validate">
                  <label class="active" for="balance">Balance</label>
                </div>
              </div>
            </form>
          </div>
          {{/with}}
        </div>
        <div id="favorites" class="card-scrollable col s12">
            <div class="row">
              <div class="input-field col s10">
                <input id="favorite" placeholder="New Entry ..." type="text" class="validate" data-length="60">
              </div>
              <div class="col s2 ">
                <!-- <button type="submit" class=" col s12 btn center btn-primary "></button> -->
                <a class="addFavorite vertical-center btn btn-floating waves-effect waves-light z-depth-1"><i class="material-icons">playlist_add</i></a>
              </div>
            </div>
            <ul class="collapsible z-depth-0" data-collapsible="accordion">
              {{#each favorite in favorites customerId}}
                <li>
                  <div class="collapsible-header">
                    <span class="left">{{favorite.keyWord}}</span>
                    <a href="#key-{{favorite.keyWord}}"><i class="material-icons right">mode_edit</i></a>
                    <span class="right">{{since favorite.time}}</span>
                  </div>
                  <div id="key-{{favorite.keyWord}}" class="collapsible-body">
                    <div id="key" value="{{favorite.keyWord}}"></div>
                    <div class="row">
                      <!-- {{#autoForm collection="Favorites" id="favoritesUpdateForm" type="update"}} -->
                        <div class="container center">
                          <div class="input-field col s12">
                            <!-- {{>afFieldInput name="keyWord" id="keyWord" type="text"}} -->
                            <input value="{{favorite.keyWord}}" id="key_word" type="text" class="validate">
                            <label class="active">Key Word</label>
                          </div>

                          <br>
                          <button type="submit" class="editFavorite col s4 btn left btn-primary ">Change</button>
                          <button type="submit" class="deleteFavorite col s4 btn right btn-primary ">Delete</button>
                        </div>
                      <!-- {{/autoForm}} -->
                    </div>
                  </div>
                </li>
              {{/each}}
              <li>
                <div class="collapsible-header">
                  <span class="left">Example</span>
                  <i class="material-icons right">mode_edit</i>
                  <span class="right">5 days</span>
                </div>
                <div class="collapsible-body">
                  <div class="row">
                    <!-- {{#autoForm collection="Favorites" doc=favorites id="updateKeyForm" type="update"}} -->
                      <div class="container center">
                        <div class="input-field col s12">
                          <!-- {{>afFieldInput name="keyWord" id="keyWord" type="text"}} -->
                          <input value="example" id="key_word" type="text" class="validate">
                          <label class="active">Key Word</label>
                        </div>

                        <br>
                        <button type="submit" class="editFavorite col s4 btn left btn-primary ">Change</button>
                        <button type="submit" class="deleteFavorite col s4 btn right btn-primary ">Delete</button>
                      </div>
                    <!-- {{/autoForm}} -->
                  </div>
                </div>
              </li>
            </ul>
        </div>
        <div id="addresses" class="scrollable-info col s12">
            <ul class="collapsible z-depth-0" data-collapsible="accordion">
              {{#each address in addresses customerId}}
                <li>
                  <div class="collapsible-header">{{address.title}}<span class="right"><a href="#editAddress-{{address.title}}"><i class="material-icons right">mode_edit</i></a></span></div>
                  <div class="collapsible-body">
                    <span class="left">{{address.line1}}</span><br>
                    <span class="left">{{address.line2}}</span><br>
                    <span class="left">{{address.city}}, {{address.province}} {{address.zipCode}}</span>
                  </div>
                </li>
              {{/each}}
              <li>
                <div class="collapsible-header">US<span class="right"><a href="#editAddress-example"><i class="material-icons right">mode_edit</i></a></span></div>
                <div class="collapsible-body">
                  <span class="left">1401 College Ave.</span><br>
                  <span class="left">Apt. E304</span><br>
                  <span class="left">Manhattan, KS 66502</span>
                </div>
              </li>
            </ul>
            <div class="row">
              <div class="col s12">
                <a class="vertical-center btn btn-floating waves-effect waves-light z-depth-1" href="#addAddress"><i class="material-icons">playlist_add</i></a>
              </div>
            </div>
        </div>
      </div>
    </div>

    <!-- Modals -->
    {{#each address in addresses customerId}}
    <div id="editAddress-{{address.title}}" class="modal">
      <div class="modal-content">
        <div class="row">
          <h4 id="title" value="{{address.title}}">{{address.title}}</h4>
        </div>
        <div class="row">
          <div class="input-field col s12">
            <input value="{{address.line1}}" id="line1" type="text" class="validate">
            <label class="active" for="line1">Line 1</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12">
            <input value="{{address.line2}}" id="line2" type="text" class="validate">
            <label class="active" for="line2">Line 2</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s5">
            <input value="{{address.city}}" id="city" type="text" class="validate">
            <label class="active" for="city">City</label>
          </div>
          <div class="input-field col s5">
            <input value="{{address.province}}" id="province" type="text" class="validate">
            <label class="active" for="province">Province</label>
          </div>
          <div class="input-field col s2">
            <input value="{{address.zipCode}}" id="zipcode" type="text" class="validate">
            <label class="active" for="zipcode">Zip Code</label>
          </div>
        </div>
        <center><a class="editAddress waves-effect waves-light btn"><input type="submit" value="Save"></a></center>
      </div>
    </div>
    {{/each}}

    <div id="editAddress-example" class="modal">
      <div class="modal-content">
        <div class="row">
          <div class="input-field col s12">
            <input value="1401 College Ave." id="line1" type="text" class="validate">
            <label class="active" for="line1">Line 1</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12">
            <input value="Apt. E304" id="line2" type="text" class="validate">
            <label class="active" for="line2">Line 2</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s5">
            <input value="Manhattan" id="city" type="text" class="validate">
            <label class="active" for="city">City</label>
          </div>
          <div class="input-field col s5">
            <input value="KS" id="province" type="text" class="validate">
            <label class="active" for="province">Province</label>
          </div>
          <div class="input-field col s2">
            <input value="66502" id="zipcode" type="text" class="validate">
            <label class="active" for="zipcode">Zip Code</label>
          </div>
        </div>
        <center><a class="waves-effect waves-light btn"><input type="submit" value="Save"></a></center>
      </div>
    </div>

    <!-- Add an Address -->
    <div id="addAddress" class="modal">
      <div class="modal-content">
        <div class="row">
          <div class="input-field col s5">
            <input value="" id="addtitle" type="text" class="validate">
            <label class="active" for="title">Title</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12">
            <input value="Street Address" id="addline1" type="text" class="validate">
            <label class="active" for="line1">Line 1</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s12">
            <input value="Neighborhood" id="addline2" type="text" class="validate">
            <label class="active" for="line2">Line 2</label>
          </div>
        </div>
        <div class="row">
          <div class="input-field col s5">
            <input value="" id="addcity" type="text" class="validate">
            <label class="active" for="city">City</label>
          </div>
          <div class="input-field col s5">
            <input value="" id="addprovince" type="text" class="validate">
            <label class="active" for="province">Province</label>
          </div>
          <div class="input-field col s2">
            <input value="" id="addzipcode" type="text" class="validate">
            <label class="active" for="zipcode">Zip Code</label>
          </div>
        </div>
        <center><a class="addAddress waves-effect waves-light btn"><input type="submit" value="Add"></a></center>
      </div>
    </div>

    <div id="hist" class="card-scrollable col s12">
      <div class="container col s12">
        <ul class="collapsible z-depth-0" data-collapsible="accordion">
          {{#each transaction in history customerId}}
              <li>
                <div class="collapsible-header">
                  <span class="left">{{transaction.title}}</span>
                  <span class="right">{{since transaction.time}}</span>
                </div>
                <div class="collapsible-body">
                  <span class="left">{{favorite.description}}</span>
                  <span class="right">SAR{{favorite.price}}</span>
                  <span> ({{favorite.status}})</span>
                </div>
              </li>
          {{/each}}
          <li>
            <div class="collapsible-header">
              <span class="left">Al Baik</span>
              <span class="right">3 days ago</span>
            </div>
            <div class="collapsible-body">
              <span class="left">٢ مسحب حراق</span>
              <span class="right">SAR23.00</span>
              <span> (cancelled)</span>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</template>

<template name="addressCollapsable">
  <li>
    <div class="collapsible-header">{{addressCollapsable.title}}<span class="right"><a href="#editAddress"><i class="material-icons right">mode_edit</i></a></span></div>
    <div class="collapsible-body">
      <span class="left">1401 College Ave.</span><br>
      <span class="left">Apt. E304</span><br>
      <span class="left">Manhattan, KS 66502</span>
    </div>
  </li>
</template>

<template name="userChatCard">

  <!-- Display texts -->
  {{#with customerProfile customerId}}
    <div class="row no-bottom-margin">
      <div class="col s12 operator-dash-title valign-wrapper">
        <div class="auto-width center-align ellipsis">Live Chat with ({{this.firstName}} {{this.lastName}})</div>
      </div>
      <div class="col s12 divider "></div>
    </div>

    <div class="scrollable-chat" id="messageBody">
      <center class="chat-start"> --- Beginning of Chat --- </center>
       <br>
      <div class="col s12">
        <!-- I think the bug is here.. oo because customerId is undefined? -->
        <!-- CustomerId: {{../customerId}} <br>
        Arracy of Texts: {{ activeChat ../customerId}} <br> -->
        {{#with activeChat ../customerId}}
          {{#each mssg in this}}
            {{> Template.dynamic template=mssg.from data=mssg}}
          {{/each}}
        {{/with}}
      </div>
    </div>
    <div class="col s12 divider"></div>

    <div class="chat-send input-field col s12">
      <div class="row">

        <div class="col s10">
          <input id="input_text" placeholder="Text Message..." type="text" class="validate" data-length="160">
          <!-- This might be insecure... need to investigate more -->
          <input id="customerId" value={{../customerId}} type="hidden">
        </div>

        <div class="col s2 ">
          <a class="send-txt vertical-center btn btn-floating waves-effect waves-light z-depth-1"><i class="material-icons">send</i></a>
        </div>

      </div>
    </div>
    {{else}}
    <div class="row no-bottom-margin">
      <div class="col s12 operator-dash-title valign-wrapper">
        <div class="auto-width center-align ellipsis"> Chat</div>
      </div>
      <div class="col s12 divider "></div>
    </div>

    <div class="scrollable-chat" id="messageBody">
      <center class="chat-start"> --- Beginning of Chat --- </center>
    </div>
    <div class="col s12 divider"></div>

    <div class="chat-send input-field col s12">
      <div class="row">

        <div class="col s10">
          <input id="input_text" placeholder="Text Message..." type="text" class="validate" data-length="160">
          <!-- This might be insecure... need to investigate more -->
          <input id="customerId" value={{../customerId}} type="hidden">
        </div>

        <div class="col s2 ">
          <a disable class="disabled send-txt vertical-center btn btn-floating waves-effect waves-light z-depth-1"><i disable class="disabled material-icons">send</i></a>
        </div>

      </div>
    </div>
  {{/with}}
<!--   <button onclick="scrollToBottom()">Scroll contents of div</button>
 --></template>

<template name="user">
  <div class="col s7">
    <div class="card card-size message-margins grey lighten-1 z-depth-0">
      <div class="tooltipped message-padding chat-size" data-position="right" data-delay="50" data-tooltip={{formatDateTime this.createdAt}}>
            {{this.txt}}
      </div>
    </div>
  </div>
</template>

<template name="operator">
  <div class="col s7 right">
    <div class="card message-margins blue darken-1 z-depth-0">
      <div class="tooltipped message-padding chat-size" data-position="left" data-delay="50" data-tooltip={{formatDateTime this.createdAt}}>
        {{this.txt}}
      </div>
    </div>
  </div>
</template>

<template name="apiCard">
  <div class="row no-bottom-margin">
    <div class="col s12 operator-dash-title valign-wrapper">
      <div class="auto-width center-align ellipsis">SERVICES</div>
    </div>
    <div class="col s12 divider "></div>
  </div>
</template>

<template name="statusCard">

  <div class="row no-bottom-margin status-size valign-wrapper">

    <a {{disable}} class="done col s3 waves-effect waves-light green btn ellipsis tooltipped " data-position="top" data-delay="50" data-tooltip="Done! You've completed the user's ask. This will disconnect you from the user!" data={{customerId}}>
      <i class="material-icons left">done</i>
      done
    </a>

    <div class="col s1"></div>

    <a {{disable}} class="pending col s4 waves-effect waves-light orange btn ellipsis tooltipped " data-position="top" data-delay="50" data-tooltip="Pending! You've order something for the user and you are waiting for the service provider's reply.">
      <i class="material-icons left">extension</i>
      pending
    </a>

    <div class="col s1"></div>

    <a {{disable}} class="cancel col s3 waves-effect waves-light red btn ellipsis tooltipped" data-position="top" data-delay="50" data-tooltip="Cancel! You were unable to serve this user. This will disconnect you from the user!">
      <i class="material-icons left">error</i>
      Cancel
    </a>


  </div>

</template>
